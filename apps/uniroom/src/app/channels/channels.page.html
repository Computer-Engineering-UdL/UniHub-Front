<ion-content class="channels-page">
  <div class="channels-header">
    <div class="header-top">
      <div class="header-actions">
        <ion-searchbar
          [placeholder]="'CHANNELS.SEARCH_PLACEHOLDER' | translate"
          [(ngModel)]="searchQuery"
          (ionInput)="onSearchChange($event)"
          class="channels-searchbar"></ion-searchbar>
        <ion-button
          *ngIf="isAdmin"
          fill="solid"
          color="primary"
          (click)="openCreateChannelModal()"
          class="create-action-btn">
          <ion-icon slot="start" name="add-circle-outline"></ion-icon>
          {{ 'CHANNELS.CREATE_CHANNEL' | translate }}
        </ion-button>
      </div>
    </div>

    <div class="filter-section">
      <div class="tabs">
        <ion-searchbar
          [placeholder]="'CHANNELS.SEARCH_CHANNELS' | translate"
          [(ngModel)]="searchQuery"
          (ionInput)="onSearchChange($event)"
          class="mobile-searchbar"></ion-searchbar>
        <button
          *ngIf="currentUser"
          class="tab-btn"
          [class.active]="selectedTab === 'myChannels'"
          (click)="onTabChange('myChannels')">
          {{ 'CHANNELS.MY_CHANNELS' | translate }}
          <span class="tab-badge">{{ myChannelsCount }}</span>
        </button>
        <button
          class="tab-btn"
          [class.active]="selectedTab === 'explore'"
          (click)="onTabChange('explore')">
          {{ 'CHANNELS.EXPLORE_CHANNELS' | translate }}
          <span class="tab-badge">{{ exploreChannelsCount }}</span>
        </button>
      </div>

      <div class="category-filters">
        <button
          *ngFor="let category of categories"
          class="category-chip"
          [class.active]="selectedCategory === category"
          [attr.data-category]="category"
          (click)="onCategoryChange(category)">
          <ion-icon [name]="getCategoryIcon(category)"></ion-icon>
          {{ getCategoryTranslation(category) }}
        </button>
      </div>
    </div>
  </div>

  <div class="channels-content">
    <div *ngIf="isLoading" class="loading-container">
      <ion-spinner name="crescent"></ion-spinner>
      <p>{{ 'CHANNELS.LOADING' | translate }}</p>
    </div>

    <div *ngIf="!isLoading && filteredChannels.length === 0" class="empty-state">
      <ion-icon name="megaphone-outline"></ion-icon>
      <h2>{{ 'CHANNELS.NO_CHANNELS' | translate }}</h2>
      <p>{{ 'CHANNELS.NO_CHANNELS_DESCRIPTION' | translate }}</p>
    </div>

    <div *ngIf="!isLoading && filteredChannels.length > 0" class="channels-grid">
      <div
        *ngFor="let channel of filteredChannels"
        class="channel-card"
        [attr.data-category]="channel.category">
        <div class="channel-icon emoji-icon">
          <span class="channel-emoji">{{ getChannelEmoji(channel) }}</span>
        </div>
        <div class="channel-info">
          <div class="channel-header">
            <h3 class="channel-name">{{ channel.name }}</h3>
            <span class="channel-category">
              <ion-icon [name]="getCategoryIcon(channel?.category)"></ion-icon>
              {{ getCategoryTranslation(channel?.category) }}
            </span>
          </div>
          <p class="channel-description">{{ channel.description }}</p>
          <div class="channel-footer">
            <div class="member-count" *ngIf="currentUser">
              <ion-icon name="people"></ion-icon>
              <span>{{ 'CHANNELS.MEMBERS' | translate: { count: channel.member_count } }}</span>
            </div>
            <div class="channel-actions">
              <ion-button
                *ngIf="!channel.is_member"
                fill="solid"
                class="join-btn"
                size="small"
                (click)="joinChannel(channel); $event.stopPropagation()">
                {{ 'CHANNELS.JOIN' | translate }}
              </ion-button>
              <ion-button
                *ngIf="channel.is_member"
                fill="outline"
                color="medium"
                size="small"
                (click)="leaveChannel(channel); $event.stopPropagation()">
                {{ 'CHANNELS.LEAVE' | translate }}
              </ion-button>
              <ion-button
                *ngIf="isAdmin"
                fill="outline"
                color="primary"
                size="small"
                (click)="editChannel(channel); $event.stopPropagation()">
                <ion-icon slot="icon-only" name="pencil-outline"></ion-icon>
              </ion-button>
              <ion-button
                *ngIf="isAdmin"
                fill="solid"
                color="danger"
                size="small"
                (click)="deleteChannel(channel); $event.stopPropagation()">
                <ion-icon slot="icon-only" name="trash"></ion-icon>
              </ion-button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</ion-content>
